{% extends 'layout.jinja2' %}

{% block title %}Alberghi{% endblock %}

{% block hamburger %}
  <a id="openNav" href="javascript: void(0)" class="w3-bar-item w3-ripple w3-button w3-hover-theme w3-xlarge w3-hide-large" onclick="toggleMenu()">&#9776;</a>
{% endblock %}

{% block aside %}
<div id="sidebar" class="w3-sidebar w3-bar-block w3-card w3-theme-l4 w3-collapse w3-animate-top" style="width: 25%; overflow: auto;">
  <h5 class="w3-bar-item w3-theme-d4">Alberghi</h5>
  {% for hotel in hotels %}
  	<button id="btn_{{ hotel.Hotel.id }}" class="w3-bar-item w3-button w3-ripple w3-hover-theme tablink" data-hotel-id="{{ hotel.Hotel.id }}">{{ hotel.Hotel.name }}</button>
  {% endfor %}
  <h6 class="w3-bar-item w3-theme-d4">Alberghi senza tappa</h5>
  {% if hotels_nb %}
    {% for hotel in hotels_nb %}
      	<button id="btn_{{ hotel.Hotel.id }}" class="w3-bar-item w3-button w3-ripple w3-hover-theme tablink" data-hotel-id="{{ hotel.Hotel.id }}">{{ hotel.Hotel.name }}</button>
    {% endfor %}
  {% endif %}
  {% if '_user_id' in session.keys() %}
    <div class="w3-container" style="margin-top: 20px">
      <a href="{{ url_for('dbms_bp.add_hotel') }}" class="w3-bar-item w3-center w3-ripple" title="Aggiungi hotel"><span class="material-symbols-outlined icon28">add</span></a>
    </div>
  {% endif %}
  <button class="w3-bar-item w3-button w3-hover-theme-l4" style="height: 120px"> </button>
</div>
{% endblock %}

{% block content %}
<div id="display" class="w3-main" style="margin-left: 25%;">
    <div id="hotel" class="w3-container w3-center albergo">
        <header>
            <div class="w3-display-container" style="height: 200px;">
                {% if hotel.photo %}
                 <img src={{ url_for("download_files", filename="images/"+hotel.photo) }} class="w3-display-left w3-margin-left w3-margin-top webp">
                {% else %}
                 <img src={{ url_for("static", filename="images/default.webp") }} class="w3-display-left w3-margin-left w3-margin-top webp">
                {% endif %}
                <h2 class="w3-display-middle">{{ hotel.name }}</h2>
            </div>
        </header>
        <article style="margin: 60px 5% 0 5%;">
            <div class="row w3-row">
                <div class="w3-container w3-third w3-mobile">
                    <p class="w3-left-align wbold">Indirizzo:</p>
                </div>
                <div class="w3-container w3-twothird w3-mobile">
                    <p class="w3-left-align">{{ hotel.address }}</p>
                </div>
            </div>

            <div class="row w3-row">
                <div class="w3-container w3-third w3-mobile">
                    <p class="w3-left-align wbold">Città:</p>
                </div>
                <div class="w3-container w3-twothird w3-mobile">
                    <p class="w3-left-align">{{ hotel.town }}</p>
                </div>
            </div>

            <div class="row w3-row">
                <div class="w3-container w3-third w3-mobile">
                    <p class="w3-left-align wbold">Prenotazione:</p>
                </div>
                <div class="w3-container w3-twothird w3-mobile">
                    {% if hotel.reserved %}
                    <p class="w3-left-align"><span  class="material-symbols-outlined done">done</span></p>
                    {% else %}
                    <p></p>
                    {% endif %}
                </div>
            </div>

            {% if hotel.check_in %}
            <div class="row w3-row">
                <div class="w3-container w3-third 3w-mobile">
                    <p class="w3-left-align wbold">Check-in:</p>
                </div>
                <div class="w3-container w3-twothird w3-mobile">
                    <p class="w3-left-align">{{ hotel.check_in.strftime("%A %d %b %Y") }}</p>
                </div>
            </div>
            {% endif %}

            {% if hotel.check_out %}
               {% set check_out = hotel.check_out.strftime("%A %d %b %Y") %}
            {% elif hotel.check_in %}
               {% set check_out = (hotel.check_in + timedelta(days=1)).strftime("%A %d %b %Y") %}
            {% else %}
               {% set check_out = None %}
            {% endif %}

            {% if check_out %}
            <div class="row w3-row">
                <div class="w3-container w3-third 3w-mobile">
                    <p class="w3-left-align wbold">Check-out:</p>
                </div>
                <div class="w3-container w3-twothird w3-mobile">
                    <p class="w3-left-align">{{ check_out }}</p>
                </div>
            </div>
            {% endif %}

            {% if hotel.price %}
            <div class="row w3-row">
                <div class="w3-container w3-third 3w-mobile">
                    <p class="w3-left-align wbold">Costo:</p>
                </div>
                <div class="w3-container w3-twothird w3-mobile">
                    <p class="w3-left-align">€ {{ hotel.price }}</p>
                </div>
            </div>
            {% endif %}

            {% if hotel.lap %}
            <div class="row w3-row">
                <div class="w3-container w3-third 3w-mobile">
                    <p class="w3-left-align wbold">Tappa:</p>
                </div>
                <div class="w3-container w3-twothird w3-mobile">
                    <p class="w3-left-align"><a href='{{ url_for("lap_bp.tappa", id=hotel.lap.id) }}'>{{ hotel.lap.start }} - {{ hotel.lap.destination }}</a></p>
                </div>
            </div>
            {% endif %}

            {% if hotel.link %}
            <div class="row w3-row">
                <div class="w3-container w3-third w3-mobile">
                    <p class="w3-left-align wbold">Sito web:</p>
                </div>
                <div class="w3-container w3-twothird w3-mobile">
                    <p class="w3-left-align"><a href="{{ hotel.link }}" target="_blank" alt="pagine hotel su Booking.com">{{ hotel.name }}</a></p>
                </div>
            </div>
            {% endif %}

            {% if '_user_id' in session.keys() %}
                <div class="w3-container w3-center" style="margin-top: 60px;">
                    <div class="w3-bar">
                        <a href="{{ url_for('dbms_bp.update_hotel', id=hotel.id) }}" class="w3-bar-item w3-ripple" title="Modifica questo hotel"><span class="material-symbols-outlined icon28">edit</span></a>
                        <a href="{{ url_for('dbms_bp.delete_hotel', id=hotel.id) }}" class="w3-bar-item w3-ripple" title="Cancella questo hotel"><span class="material-symbols-outlined icon28">delete</span></a>
                    </div>
                </div>
             {% endif %}
        </article>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
   const SCRIPT_ROOT = {{ url_for("lap_bp.albergoJSON", id=-1)|tojson }};
   const session = {{ session|tojson }};
   const btn = document.querySelector(`#btn_{{ hotel.id }}`);
   btn.className += " w3-theme-d2";
</script>
{% endblock %}
